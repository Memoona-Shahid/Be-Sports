<section class="explore-products">
    <div class="container">
        <h2>OUR PRODUCT COLLECTION</h2>

        <form action="/products" method="GET" class="filter-form">
            <label for="category">Category:</label>
            <select name="category" id="category" onchange="this.form.submit()">
                <option value="All" <%= currentCategory === 'All' ? 'selected' : '' %>>All Categories</option>
                <% categories.forEach(cat => { %>
                    <option value="<%= cat %>" <%= currentCategory === cat ? 'selected' : '' %>>
                        <%= cat %>
                    </option>
                <% }) %>
            </select>
            
            <label for="priceMin">Min Price:</label>
            <input type="number" name="priceMin" id="priceMin" value="<%= currentPriceMin %>" min="0">
            
            <label for="priceMax">Max Price:</label>
            <input type="number" name="priceMax" id="priceMax" value="<%= currentPriceMax %>" min="0">
            
            <button type="submit" class="btn-small">Apply Filters</button>
            <a href="/products" class="btn-small" style="background: #ccc; color: #333;">Reset</a>
        </form>

        <div class="product-list">
            <% if (products.length > 0) { %>
                <% products.forEach(product => { %>
                    <div class="product-item">
                        <img src="/images/<%= product.image %>" alt="<%= product.name %>">
                        <h3><%= product.name %></h3>
                        <p style="color: greenyellow; font-size: 1.2em; font-weight: bold;">$<%= product.price.toFixed(2) %></p>
                        <p style="font-size: 0.9em;">
                            <%= (product.description && product.description.length > 50) ? product.description.substring(0, 50) + '...' : product.description %>
                        </p>
                       <form action="/products/add-to-cart" method="POST">
                          <input type="hidden" name="productId" value="<%= product._id %>">
                          <input type="hidden" name="name" value="<%= product.name %>">
                          <input type="hidden" name="price" value="<%= product.price %>">
                         <input type="hidden" name="image" value="<%= product.image %>">
                        <button type="submit" class="btn">Add to Cart ðŸ›’</button>
                       </form>
                    </div>
                <% }) %>
            <% } else { %>
                <p>No products found matching your criteria.</p>
            <% } %>
        </div> <% if (totalPages > 1) { %>
        <div class="pagination-container">
            <div class="pagination-controls">
                <% for(let i = 1; i <= totalPages; i++) { %>
                    <% 
                        const queryString = new URLSearchParams({
                            page: i, 
                            category: currentCategory,
                            priceMin: currentPriceMin,
                            priceMax: currentPriceMax
                        }).toString(); 
                    %>
                    <a href="/products?<%= queryString %>" 
                       class="page-link <%= i === currentPage ? 'active' : '' %>">
                       <%= i %>
                    </a>
                <% } %>
            </div>
        </div>
        <% } %>

    </div> </section>